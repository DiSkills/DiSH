TEST_BIN_DIR = $(BIN_DIR)/test

TEST_DIR = test
TEST_MODULES = str.c wordlist.c line.c line_process_char.c
TESTS = $(TEST_MODULES:%.c=$(TEST_BIN_DIR)/%)

TEST_FRAMEWORK = unity

# dependent directories
$(TEST_BIN_DIR):
	mkdir -p $@

$(TESTS): | $(TEST_BIN_DIR)

# unit testing framework
$(LIB_DIR)/$(TEST_FRAMEWORK): | $(LIB_DIR)
	git clone https://github.com/ThrowTheSwitch/Unity.git $@

# tests
$(TEST_BIN_DIR)/%: $(TEST_DIR)/%.c $(OBJS)
	$(CC) $(CFLAGS) $^ -o $@

unittests: $(TESTS)
	for test in $^; do ./$$test; done

tests: $(TARGET) unittests
	./test_dish.sh $< $(TEST_DIR)/data
