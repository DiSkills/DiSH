TEST_BIN_DIR = $(BIN_DIR)/test

TEST_DIR = test

TEST_UNIT_DIR = $(TEST_DIR)/unit
TEST_UNITS = $(wildcard $(TEST_UNIT_DIR)/*.c)
TESTS = $(TEST_UNITS:$(TEST_UNIT_DIR)/%.c=$(TEST_BIN_DIR)/%)


install_unity:
	cd lib/unity/ && mkdir -p build && cd build && pwd && cmake .. && cmake --build . && make install/local


# dependent directories
$(TEST_BIN_DIR):
	mkdir -p $@

$(TESTS): | $(TEST_BIN_DIR)


# tests
$(TEST_BIN_DIR)/%: $(TEST_UNIT_DIR)/%.c $(OBJS)
	$(CC) $(CFLAGS) $(CPPFLAGS) $(LDFLAGS) $^ -lunity -o $@


unittests: $(TESTS)
	for test in $^; do \
		echo "\n*****TEST $$test*****"; \
		set -e; \
		./$$test; \
	done
